# 🚀 バックエンド技術スタック

## 📋 概要

高性能なAPIサーバーをFastifyベースで構築し、TypeScriptによる型安全な開発環境を提供します。

---

## ⚙️ コア技術

### ランタイム・フレームワーク

| 技術           | バージョン | 役割                              | 選定理由                                   |
| -------------- | ---------- | --------------------------------- | ------------------------------------------ |
| **Node.js**    | 22.x LTS   | JavaScriptランタイム              | 最新LTS版による安定性とパフォーマンス      |
| **Fastify**    | 5.x        | Webアプリケーションフレームワーク | Expressより2-3倍高速、TypeScript First設計 |
| **TypeScript** | 5.x        | 型安全なJavaScript                | バグの早期発見、開発効率向上               |

### Fastifyを選定した理由

- **高パフォーマンス**: Expressより2-3倍高速な処理速度
- **TypeScript First**: ネイティブTypeScriptサポート
- **プラグインシステム**: 高い拡張性とモジュール性
- **JSON Schema**: 組み込みのスキーマベースバリデーション
- **HTTP/2サポート**: モダンなプロトコル対応

---

## 🔒 セキュリティ・ミドルウェア

| 技術                    | 役割                     | 詳細                                    |
| ----------------------- | ------------------------ | --------------------------------------- |
| **@fastify/helmet**     | セキュリティヘッダー設定 | XSS、クリックジャッキング等の攻撃を防御 |
| **@fastify/cors**       | CORS対応                 | クロスオリジンリクエストの制御          |
| **@fastify/rate-limit** | レート制限               | DoS攻撃の防御、API使用量制限            |
| **Zod**                 | バリデーション           | スキーマベースの入力検証                |

### Zodを選定した理由

- **TypeScript統合**: スキーマから自動型生成
- **パフォーマンス**: 高速でゼロ依存
- **開発体験**: 直感的なAPI設計
- **エラーハンドリング**: 詳細で分かりやすいエラー情報

---

## 🗄️ データベース・認証

### データベース構成

| 環境           | 技術                  | 役割                     |
| -------------- | --------------------- | ------------------------ |
| **開発**       | Supabase Local        | ローカルPostgreSQL + API |
| **全環境共通** | @supabase/supabase-js | Supabase JavaScript SDK  |

### 認証・セキュリティ

| 技術                         | 役割             | 詳細                                     |
| ---------------------------- | ---------------- | ---------------------------------------- |
| **Supabase Auth (Local)**    | 開発環境認証     | ローカルでのユーザー認証・セッション管理 |
| **Row Level Security (RLS)** | データベース認可 | データベースレベルでのアクセス制御       |

---

## 🐳 開発環境インフラ

### Docker構成（2025年ベストプラクティス）

| 技術                          | 用途                 | 効果                                            |
| ----------------------------- | -------------------- | ----------------------------------------------- |
| **Multi-Stage Docker Builds** | 最適化されたイメージ | 開発・ビルド・本番ステージ分離（70%サイズ削減） |
| **Docker Compose**            | サービス統合管理     | API・データベース・関連サービスの一括管理       |
| **Docker BuildKit**           | 高速ビルド           | 並列ビルドとレイヤーキャッシュ最適化            |

### 開発効率化ツール

| 技術             | 役割               | 特徴                                  |
| ---------------- | ------------------ | ------------------------------------- |
| **nodemon**      | 自動再起動         | ファイル変更検知によるホットリロード  |
| **tsx**          | TypeScript直接実行 | ts-nodeより高速な次世代実行ツール     |
| **Supabase CLI** | ローカル環境管理   | PostgreSQL、API、認証をDocker内で提供 |

### Supabase Local環境の利点

- **完全ローカル環境**: Docker内で全サービスが稼働
- **本番環境分離**: 開発データの安全な隔離
- **高速開発**: ローカルDBによる低レイテンシ
- **マイグレーション管理**: スキーマ変更のバージョン管理
- **チーム開発**: 統一された開発環境

---

## 🔧 開発ツール・品質管理

### コード品質

| 技術                   | 役割                   | 設定                     |
| ---------------------- | ---------------------- | ------------------------ |
| **ESLint**             | コード品質チェック     | TypeScript専用ルール適用 |
| **@typescript-eslint** | TypeScript用プラグイン | 型安全性の検証           |
| **Prettier**           | コードフォーマッター   | 統一されたコードスタイル |

### 環境・設定管理

| 技術       | 役割         |
| ---------- | ------------ |
| **dotenv** | 環境変数管理 |

### テスト（将来実装予定）

| 技術            | 役割                       | 選定理由                            |
| --------------- | -------------------------- | ----------------------------------- |
| **Jest**        | ユニットテスト・統合テスト | Node.js標準、豊富なエコシステム     |
| **@types/jest** | Jest型定義                 | TypeScript統合による型安全なテスト  |
| **supertest**   | APIテスト                  | FastifyアプリケーションのHTTPテスト |

---

---

## 📊 開発環境の起動フロー

```bash
# 1. 環境変数の設定
cp .env.example .env

# 2. Dockerコンテナの起動
docker-compose up -d

# 3. Supabase Localの起動
supabase start

# 4. 開発サーバーの起動（ホットリロード付き）
npm run dev
```

---

## 🔍 モニタリング・デバッグ

### 開発環境ツール

- **Fastify Logger**: 組み込みロギング機能
- **Node.js Inspector**: デバッグプロトコル
- **Docker Logs**: コンテナログの確認
